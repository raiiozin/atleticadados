<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Status do Associado</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap');

  body {
    margin: 0;
    background: linear-gradient(135deg, #121212 40%, #008000 90%);
    font-family: 'Poppins', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
    padding: 20px;
  }

  .card {
    background: #004d00;
    border-radius: 25px;
    width: 320px;
    box-shadow: 0 0 30px #00ff00cc;
    text-align: center;
    padding: 30px 20px 40px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: default;
    position: relative;
  }

  .card:hover {
    transform: scale(1.05);
    box-shadow: 0 0 60px #00ff00dd, 0 0 20px #007700cc inset;
  }

  .card h2 {
    margin-top: 0;
    margin-bottom: 25px;
    font-size: 1.9rem;
    text-shadow: 0 0 10px #00ff00cc;
    letter-spacing: 1.2px;
  }

  .avatar {
    border-radius: 50%;
    overflow: hidden;
    width: 150px;
    height: 150px;
    margin: 0 auto 25px;
    box-shadow: 0 0 20px #00ff00bb;
    border: 4px solid #00ff00aa;
    transition: transform 0.4s ease;
  }

  .card:hover .avatar {
    transform: rotate(5deg) scale(1.05);
    box-shadow: 0 0 40px #00ff0077;
  }

  .info {
    font-size: 1.15rem;
    line-height: 1.7;
  }

  .info strong {
    display: inline-block;
    width: 90px;
    text-align: right;
    margin-right: 10px;
    color: #adff2f;
  }

  /* Status destacado */
  .status {
    color: #00ff00;
    font-weight: 700;
    font-size: 1.2rem;
    letter-spacing: 1.5px;
  }

  /* Tooltip interativo */
  .tooltip {
    position: relative;
    display: inline-block;
    cursor: help;
  }

  .tooltip .tooltip-text {
    visibility: hidden;
    width: 200px;
    background-color: #004400cc;
    color: #d4ffd4;
    text-align: center;
    border-radius: 8px;
    padding: 10px;
    position: absolute;
    bottom: 125%;
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 10;
  }

  .tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
  }

  #message {
    font-size: 1.3rem;
    color: #adff2f;
    text-align: center;
  }
</style>
</head>
<body>

<div id="card-container">
  <p id="message">Carregando...</p>
</div>

<script>
// URL da planilha publicada como CSV - substitua pela sua URL CSV real
const sheetCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS9rYtAt1C25ikgZsKJKpSPrsU9XO0xYfqT0aHaG8tb-U78Dc00dx2y1MG7gW9c7g/pub?output=csv';

// Pega o parâmetro "id" da URL
function getIdFromUrl() {
  const params = new URLSearchParams(window.location.search);
  return params.get('id');
}

// Converte CSV para array de objetos
function csvToArray(str, delimiter = ',') {
  const lines = str.trim().split('\n');
  const headers = lines.shift().split(delimiter);
  return lines.map(line => {
    const data = line.split(delimiter);
    return headers.reduce((obj, header, i) => {
      obj[header.trim()] = data[i] ? data[i].trim() : '';
      return obj;
    }, {});
  });
}

// Cria o cartão HTML para o associado
function createCard(user) {
  const avatarUrl = user.Foto || 'https://i.imgur.com/oCdNCAT.png';

  let tooltipText = '';
  if (user.Status.toLowerCase() === 'pago') {
    tooltipText = 'Pagamento confirmado. Todos os benefícios ativos!';
  } else if (user.Status.toLowerCase() === 'pendente') {
    tooltipText = 'Pagamento pendente. Benefícios suspensos até regularização.';
  } else {
    tooltipText = 'Status desconhecido.';
  }

  const card = document.createElement('div');
  card.className = 'card';
  card.setAttribute('tabindex', '0');
  card.setAttribute('aria-label', `Status do Associado ${user.Nome}. Status ${user.Status}, RA ${user.RA || user.ID || ''}, validade até ${user.Validade}.`);

  card.innerHTML = `
    <h2>Status do Associado</h2>
    <div class="avatar">
      <img src="${avatarUrl}" alt="Foto do associado ${user.Nome}" width="150" height="150" />
    </div>
    <div class="info">
      <p><strong>Nome:</strong> ${user.Nome}</p>
      <p><strong>Status:</strong> <span class="status tooltip">${user.Status.toUpperCase()}
        <span class="tooltip-text">${tooltipText}</span>
      </span></p>
      <p><strong>RA:</strong> ${user.RA || user.ID || ''}</p>
      <p><strong>Validade:</strong> ${user.Validade}</p>
    </div>
  `;

  return card;
}

// Carrega e exibe o cartão do associado pelo ID
async function loadCardById() {
  const container = document.getElementById('card-container');
  const message = document.getElementById('message');
  const id = getIdFromUrl();

  if (!id) {
    message.innerText = 'Por favor, informe o ID na URL. Exemplo: ?id=1';
    return;
  }

  try {
    const response = await fetch(sheetCsvUrl);
    if (!response.ok) throw new Error('Erro ao buscar dados da planilha');
    const csvText = await response.text();
    const users = csvToArray(csvText);

    const user = users.find(u => u.ID === id || u.RA === id);
    if (!user) {
      message.innerText = 'Associado não encontrado.';
      return;
    }

    container.innerHTML = '';
    const card = createCard(user);
    container.appendChild(card);

  } catch (error) {
    console.error(error);
    message.innerText = 'Erro ao carregar os dados.';
  }
}

loadCardById();
</script>

</body>
</html>